# 如何授予其他用戶管理員權限

## 📋 步驟說明

### 1. 確認您已經是管理員
- 只有管理員才能授予其他用戶管理員權限
- 如果您看到「用戶權限管理」區塊，表示您已經是管理員

### 2. 前往「設定」頁面
- 點擊底部導航欄的「設定」圖標
- 或直接訪問 `/admin` 頁面

### 3. 找到「用戶權限管理」區塊
- 在「團隊成員」區塊下方
- 標題為「🔐 用戶權限管理」

### 4. 查看用戶列表
- 列表中會顯示所有已註冊的用戶
- 每個用戶會顯示：
  - 頭像圖標（紅色 = 管理員，藍色 = 普通用戶）
  - 用戶名稱或 Email
  - 管理員標籤（如果是管理員）
  - 「您」標籤（如果是當前登入用戶）

### 5. 授予管理員權限
- 找到要設為管理員的用戶（例如：peter）
- 點擊該用戶右側的「設為管理員」按鈕（綠色按鈕）
- 系統會立即更新權限
- 該用戶的頭像會變成紅色，並顯示「管理員」標籤

### 6. 移除管理員權限
- 找到要移除管理員權限的用戶
- 點擊該用戶右側的「移除管理員」按鈕（紅色按鈕）
- 系統會立即更新權限

## ⚠️ 重要說明

### 為什麼自己的帳號顯示「無法修改」？
- **安全保護**：為了防止管理員誤操作導致自己失去管理員權限
- 如果您需要修改自己的權限，需要：
  1. 先授予另一個用戶管理員權限
  2. 讓該用戶幫您修改權限
  3. 或直接在 Supabase Dashboard 中修改

### 如果看不到其他用戶怎麼辦？
可能的原因：
1. **用戶還沒有任何活動**：系統只會顯示已經在資料庫中有記錄的用戶（例如：有裝備、有數據、或已創建 profile）
2. **用戶剛註冊**：新註冊的用戶可能需要等待一段時間才會出現在列表中
3. **資料庫表未創建**：如果 `user_roles` 表不存在，請先執行 SQL 腳本

### 解決方法：
1. **讓用戶先使用系統**：讓其他用戶先登入並添加一些裝備或數據
2. **檢查資料庫**：確認 `user_roles` 表已創建（執行 `supabase/migration_add_user_roles.sql`）
3. **重新整理頁面**：有時候需要重新整理才能看到新用戶

## 🔍 檢查用戶是否在列表中

如果用戶已經註冊但沒有出現在列表中，可以：

1. **讓用戶先登入並使用系統**
   - 添加一些個人裝備
   - 或填寫緊急資訊
   - 這樣系統就能檢測到該用戶

2. **檢查用戶是否已註冊**
   - 在 Supabase Dashboard > Authentication > Users 中查看
   - 確認用戶已經成功註冊

3. **手動觸發同步**（如果需要）
   - 在 Supabase SQL Editor 中執行：
   ```sql
   SELECT sync_auth_to_user_roles();
   ```

## 📝 使用範例

### 範例 1：授予 peter 管理員權限
1. 前往「設定」頁面
2. 找到「用戶權限管理」區塊
3. 在列表中找到「peter」（peter236541@gmail.com）
4. 點擊右側的「設為管理員」按鈕
5. 確認後，peter 就成為管理員了

### 範例 2：移除管理員權限
1. 找到要移除權限的用戶
2. 點擊「移除管理員」按鈕
3. 確認後，該用戶就失去管理員權限了

## 🆘 常見問題

### Q: 點擊按鈕沒有反應？
A: 請檢查：
1. 您是否已經登入為管理員
2. 瀏覽器控制台是否有錯誤訊息
3. `user_roles` 表是否已創建

### Q: 顯示「更新失敗」？
A: 可能的原因：
1. `user_roles` 表不存在 → 請先執行 SQL 腳本
2. 權限不足 → 請確認您是管理員
3. 網路問題 → 請檢查網路連接

### Q: 可以有多個管理員嗎？
A: 可以！系統支援多個管理員同時存在。

### Q: 權限變更後多久生效？
A: 權限變更會立即生效。如果用戶正在使用系統，可能需要重新整理頁面才能看到變更。

## 🔧 技術細節

- **權限存儲**：`user_roles` 表的 `is_admin` 欄位
- **自動同步**：權限變更會自動同步到 `auth.users.raw_user_meta_data`
- **即時更新**：其他管理員的頁面會自動更新（通過 Realtime）

## 📚 相關文件

- `USER_PERMISSION_MANAGEMENT.md` - 詳細的功能說明
- `supabase/migration_add_user_roles.sql` - 創建用戶角色表的 SQL 腳本

